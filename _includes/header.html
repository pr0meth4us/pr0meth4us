<header class="shadow-sm bg-white py-4 px-6 border-b border-gray-300">
    <div class="container mx-auto flex justify-between items-center">
        <div>
            <a href="{{ '/' | relative_url }}" class="flex items-center space-x-3 text-2xl font-bold tracking-tight transition duration-300 hover:text-gray-700">
                <img src="https://res.cloudinary.com/dktzt7yn1/image/upload/v1741585138/prometheus_cju1pn.png" alt="Prometheus Logo" class="h-12 w-auto">
                <span class="lg:block hidden">{{ site.title }}</span>
            </a>
        </div>

        {% for item in site.navigation %}
        {% assign item_url = item.url | remove: ".html" %}
        {% assign page_url = page.url | remove: ".html" | remove: site.baseurl %}

        {% comment %} Extract just the first section of the page URL {% endcomment %}
        {% assign url_parts = page_url | split: "/" %}
        {% assign first_section = "" %}
        {% if url_parts.size > 1 and url_parts[1] != "" %}
        {% assign first_section = "/" | append: url_parts[1] | append: "/" %}
        {% else %}
        {% assign first_section = "/" %}
        {% endif %}

        {% comment %} Extract just the first section of the item URL {% endcomment %}
        {% assign item_url_parts = item_url | split: "/" %}
        {% assign item_first_section = "" %}
        {% if item_url_parts.size > 1 and item_url_parts[1] != "" %}
        {% assign item_first_section = "/" | append: item_url_parts[1] | append: "/" %}
        {% else %}
        {% assign item_first_section = "/" %}
        {% endif %}

        {% assign is_active = false %}
        {% if first_section == item_first_section and item_first_section != "/" %}
        {% assign is_active = true %}
        {% elsif item_url == "/" and page_url == "/" %}
        {% assign is_active = true %}
        {% endif %}

        {% capture nav_item %}
        <div class="{% if item.submenu %}dropdown-container{% endif %} nav-item">
            <a href="{{ item.url | relative_url }}"
               class="{% if is_active %}text-blue-600 active-nav{% else %}text-gray-800 hover:text-blue-600{% endif %} transition nav-link"
            >
                {{ item.text }}
                {% if item.submenu %}
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block ml-1 transform transition-transform duration-200 dropdown-arrow" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
                {% endif %}
            </a>

            {% if item.submenu %}
            <div class="dropdown-content">
                {% for subitem in item.submenu %}
                {% assign subitem_url = subitem.url | remove: ".html" %}
                {% assign subitem_is_active = page_url == subitem_url %}
                <a href="{{ subitem.url | relative_url }}"
                   class="dropdown-item {% if subitem_is_active %}text-blue-600{% else %}text-gray-700 hover:text-blue-600{% endif %} transition"
                >
                    {{ subitem.text }}
                </a>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endcapture %}

        {% assign navigation_items = navigation_items | default: "" | append: nav_item | append: "||SPLIT||" %}
        {% endfor %}

        {% assign nav_array = navigation_items | split: "||SPLIT||" %}

        <div class="md:hidden relative">
            <button id="mobile-menu-button" class="p-2 rounded-md hover:bg-gray-100 transition-colors duration-200 cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>

            <!-- Mobile Menu -->
            <div class="absolute right-0 top-full mt-2 w-72 bg-white rounded-lg shadow-xl hidden z-50 overflow-hidden border border-gray-200" id="mobile-menu">
                <div class="py-1 mobile-nav-container divide-y divide-gray-100">
                    {% for item_html in nav_array %}
                    <div class="mobile-nav-item">
                        {{ item_html }}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <nav class="hidden md:flex space-x-6 py-2 font-medium desktop-nav">
            {% for item_html in nav_array %}
            {{ item_html }}
            {% endfor %}
        </nav>
    </div>
</header>
